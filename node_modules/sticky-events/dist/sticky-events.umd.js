!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).stickyEvents=e()}(this,function(){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}return n}(t,e)||n(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||n(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var s="sticky-events--sentinel",a="sticky-events--sentinel-top",u="sticky-events--sentinel-bottom",t=function(){function c(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.container,n=void 0===e?document:e,i=t.enabled,r=void 0===i||i,o=t.stickySelector,s=void 0===o?".sticky-events":o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),this.container=n,this.observers=[],this.stickyElements=Array.from(this.container.querySelectorAll(s)),this.stickySelector=s,this.state=new Map,r&&this.enableEvents()}var t,e,n;return t=c,(e=[{key:"setState",value:function(t){this.state.get(t)||this.state.set(t,{isSticky:!1,headerSentinel:this.addSentinel(t,a),footerSentinel:this.addSentinel(t,u)})}},{key:"enableEvents",value:function(){var e=this;window.self===window.top?(this.observers={header:this.createHeaderObserver(),footer:this.createFooterObserver()},this.stickyElements.forEach(function(t){e.setState(t)})):console.warn("StickyEvents: There are issues with using IntersectionObservers in an iframe, canceling initialization. Please see https://github.com/w3c/IntersectionObserver/issues/183")}},{key:"disableEvents",value:function(t){var e=this;0<arguments.length&&void 0!==t&&!t||this.stickyElements.forEach(function(t){return e.fire(!1,t)}),Object.values(this.observers).forEach(function(t){return t.disconnect()}),this.observers=null,this.state.clear()}},{key:"addStickies",value:function(t){var e,n=this;(e=this.stickyElements).push.apply(e,r(t)),this.stickyElements.forEach(function(t){return n.setState(t)})}},{key:"addSticky",value:function(t){this.stickyElements.push(t),this.setState(t)}},{key:"addSentinel",value:function(t,e){var n=document.createElement("div"),i=t.parentElement;switch(t.style.cssText="\n      position: -webkit-sticky;\n      position: sticky;\n    ",n.classList.add(s,e),Object.assign(n.style,{left:0,position:"absolute",right:0,visibility:"hidden"}),e){case a:i.insertBefore(n,t),Object.assign(n.style,this.getSentinelPosition(t,n,e),{position:"relative"}),this.observers.header.observe(n);break;case u:i.appendChild(n),Object.assign(n.style,this.getSentinelPosition(t,n,e)),this.observers.footer.observe(n)}return n}},{key:"createHeaderObserver",value:function(){var a=this;return new IntersectionObserver(function(t){var e=l(t,1)[0],n=e.boundingClientRect,i=e.isIntersecting,r=e.rootBounds,o=e.target.parentElement,s=o.querySelector(a.stickySelector);o.style.position="relative",n.bottom<r.bottom&&i?a.fire(!1,s,c.POSITION_TOP):n.bottom<=r.top&&!i&&a.fire(!0,s,c.POSITION_TOP)},Object.assign({threshold:0},!(this.container instanceof HTMLDocument)&&{root:this.container}))}},{key:"createFooterObserver",value:function(){var s=this;return new IntersectionObserver(function(t){var e=l(t,1)[0],n=e.boundingClientRect,i=e.isIntersecting,r=e.rootBounds,o=e.target.parentElement.querySelector(s.stickySelector);n.top<r.top&&n.bottom<r.bottom&&!i?s.fire(!1,o,c.POSITION_BOTTOM):n.bottom>r.top&&s.isSticking(o)&&i&&s.fire(!0,o,c.POSITION_BOTTOM)},Object.assign({threshold:1},!(this.container instanceof HTMLDocument)&&{root:this.container}))}},{key:"fire",value:function(t,e,n){this.state.get(e).isSticky!==t&&(e.dispatchEvent(new CustomEvent(c.CHANGE,{detail:{isSticky:t,position:n},bubbles:!0})),e.dispatchEvent(new CustomEvent(t?c.STUCK:c.UNSTUCK,{detail:{isSticky:t,position:n},bubbles:!0})),this.state.set(e,{isSticky:t}))}},{key:"getSentinelPosition",value:function(t,e,n){var i=window.getComputedStyle(t),r=window.getComputedStyle(t.parentElement);switch(n){case a:return{top:"calc(".concat(i.getPropertyValue("top")," * -1)"),height:1};case u:var o=parseInt(r.paddingTop);return{bottom:i.top,height:"".concat(t.getBoundingClientRect().height+o,"px")}}}},{key:"isSticking",value:function(t){var e=t.previousElementSibling,n=t.getBoundingClientRect().top,i=e.getBoundingClientRect().top;return Math.round(Math.abs(n-i))!==Math.abs(parseInt(window.getComputedStyle(e).getPropertyValue("top")))}}])&&i(t.prototype,e),n&&i(t,n),c}();return t.CHANGE="sticky-change",t.STUCK="sticky-stuck",t.UNSTUCK="sticky-unstuck",t.POSITION_BOTTOM="bottom",t.POSITION_TOP="top",t});
